<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>my-bento</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, minimal-ui">
    <script src="https://www.itxst.com/package/vue/vue.min.js"></script>
    <script src="https://www.itxst.com/package/sortable/Sortable.min.js"></script>
    <script src="https://www.itxst.com/package/vuedraggable/vuedraggable.umd.min.js"></script>
    
    <style scoped>
        *{
            margin: 0;
            box-sizing: border-box;
            font-family: Georgia, "Times New Roman", Times, serif;
        }
        body{
            user-select: none;
            background-color: #F2F2F2;
            padding: 10px;
        }
        #app{
            display: flex;
            flex-direction: column;
            gap: 10px;
            height: calc(100vh - 30px);
        }
        .loading{
            position: fixed;
            top: 0;
            left: 0;
            z-index: 9999;
            width: 100vw;
            height: 100vh;
            background: rgba(211, 211, 211, 0.61);
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .all_recipes_wrap{
            flex: 1 0 15%;
            padding: 10px;
        }
        .sheets{
            display: flex;
            height: 30px;
        }
        .sheets .sheet_tag{
            flex: 1;
            text-align: center;
            border: 2px solid #FEDE78;
            background: #f8eabc;
            border-radius: 10px 10px 0 0;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }
        .sheets .sheet_tag.selected{
            border-bottom: unset;
            background: #FFF9E6;
        }
        .sheet_tag svg{
            height: 80%;
            width: 80%;
            color: #dc3030;
        }
        .all_recipes{
            padding: 10px;
            background: #FFF9E6;
            border: 2px solid #FEDE78;
            border-top: unset;
            border-radius: 0 0 10px 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            height: calc(100% - 30px);
        }
        .item {
            padding: 6px;
            background-color: #fdfdfd;
            border: solid 1px #eee;
            position: relative;
            cursor: grab;
            z-index: 1;
            border-radius: 10px;
            height: fit-content;
        } 
        .item:hover {
            background-color: #f1f1f1;
            cursor: grab;
        }
        .chosen {
            border: solid 1px #dc3030 !important;
        }
        .week{
            display: flex;
            gap: 5px;
            flex: 1 0 25%;
            overflow: hidden;
        }
        .area{
            display: flex;
            flex-direction: column;
            gap: 5px;
            flex: 1;
            min-height: 100px;
            font-size: 11px;
            background: #FFF9E6;
            border: 2px dashed #FEDE78;
            padding: 5px;
            border-radius: 10px;
            position: relative;
            overflow-y: auto;
            overflow-x: hidden;
        }
        .area span{
            width: 100%;
            height: 100px;
        }
        .area::before {
            position: absolute;
            margin: auto;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            color: #FEDE78;
            font-size: 11px;
            z-index: 0;
        }
        .area:nth-child(1)::before {
            content: "星期一";
        }
        .area:nth-child(2)::before {
            content: "星期二";
        }
        .area:nth-child(3)::before {
            content: "星期三";
        }
        .area:nth-child(4)::before {
            content: "星期四";
        }
        .area:nth-child(5)::before {
            content: "星期五";
        }
        .note {
            font-size: 12px;
            color: gray;
            margin-right: 5px;
        }
        .trash{
            width: 100%;
            height: 60px;
            background: rgb(253, 140, 140);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            position: fixed;
            bottom: 0;
            left: 0;
            z-index: 100;
            transform: translateY(60px);
            transition: all .3s linear .3s;
        }
        .trash.active{
            transform: translateY(0px);
        }
        .trash:has(>.chosen) svg{
            color: rgb(238, 96, 96);
            transition: all .2s linear;
        }
        .trash .item{
            display: none;
        }
        .trash svg{
            height: 50%;
            color: rgb(97, 97, 97);
            width: 100%;
        }

        .Ingredient_info{
            width: 80%;
            margin: auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .toggle_switch{
            display: flex;
            align-items: center;
            gap: 2px;
        }
        .switch_wrap{
            width: 40px;
            height: 20px;
            border-radius: 10px;
            background: #f1e7c6;
            cursor: pointer;
        }
        .switch_wrap .switch{
            width: 20px;
            height: 20px;
            border-radius: 50%;
            box-shadow: 1px 1px 4px slategrey;
            background: #FFC001;
            transition: .2s all linear;
        }
        .switch_wrap .switch.active{
            transform: translateX(100%);
        }

        .check_list{
            flex: 1 0 60%;
        }
        .ingredient_item{
            width: 80%;
            display: flex;
            margin: 10px auto;
            padding: 10px;
            background: white;
            cursor: grab;
            color: lightslategrey;
            font-weight: 900;
        }
        .root-class { background: rgb(230,220,221) }
        .leaf-class { background: rgb(238,237,219) }
        .spices-class { background: rgb(214,211,206) }
        .goods-class { background: rgb(192,208,221) }
        .bean-class { background: rgb(211,211,209) }
        .meat-class { background: rgb(237,225,229) }

        .check_icon{
            border-radius: 50%;
            width: 20px;
            height: 20px;
            border: 3px solid #E6E6E6;
            margin-right: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .check_icon svg{
            display: none;
        }
        .flex{
            display: flex;
        }
        .jcsb{
            justify-content: space-between;
            flex: 1;
        }
        .ingredient_item.done .check_icon{
            border: 3px solid #4CC06D;
        }
        .ingredient_item.done .flex{
            color: lightslategrey;
            text-decoration:line-through;
        }
        .ingredient_item.done .check_icon svg{
            color:#4CC06D;
            display: block;
            
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="loading" v-show="this.loading">載入中...</div>
        <!-- <button @click="save">save</button> -->
        <button @click="load">重新整理</button>
        <div class="all_recipes_wrap">
            <div class="sheets">
                <div class="sheet_tag" :class="{selected: type_tag=='肉'}" @click="type_tag='肉'">
                    <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                    width="49.189px" height="49.19px" viewBox="0 0 49.189 49.19" style="enable-background:new 0 0 49.189 49.19;"
                    xml:space="preserve">
               <g>
                   <path d="M48,14.409c-1.562-5.75-7.938-9.188-12.125-9.5s-7.25,1.312-11.188,2.688s-4.938-0.125-8.062-2.188s-6.188-1.223-8.25-0.75
                       C2.375,6.034,0,12.597,0,16.034s1.812,12.625,4.688,15.875s10,2.25,11.812,2.625s4.688,2.5,6.625,5.375
                       c1.938,2.875,4.562,5.375,10.312,5.188c5.75-0.188,10.5-4.188,13.5-10.312S49.562,20.159,48,14.409z M44.938,34.722
                       c-0.812,2-1.062,2.375-3.938,5.688c-2.876,3.313-5.688,3.062-8.875,2.875c-3.188-0.187-4.312-1.625-7-4.5
                       c-2.688-2.875-4-4.75-6.875-5.562c-2.875-0.812-6.812-0.5-10.188-1.125S4,26.597,4.125,25.659c0.125-0.938,1.625,0.625,2.938,1.75
                       s3.729,1.993,5.188,1.938c1.625-0.062,5.688,0.125,8.5,1s4.375,3.5,6.688,6.25c2.312,2.75,6.688,1.688,11.25,0.5
                       c4.562-1.188,6.75-5.312,7.375-5.812S45.75,32.722,44.938,34.722z M44.875,29.159c-2.375,3.812-3.938,5.75-8.062,6.75
                       c-4.123,1-6.375,1.562-8.688-0.875c-2.312-2.437-4.875-7.25-9.812-7.188c-4.937,0.062-9.938,0.062-13.063-3.437
                       c-3.125-3.5-4.562-9.688-2.5-12.875s7.188-6.812,11.062-5.125c1.939,0.844,4.938,2.688,7.75,2.938s5.312-0.375,8.062-1.562
                       s4.938-1.125,7.188-0.562s8.062,2.812,9.438,8.438S47.25,25.347,44.875,29.159z M15.812,9.784c-1.938,0-3.937,0.243-5.188,0.188
                       C6.438,9.784,5.188,12.909,5.5,15.847s3.688,4.938,6.562,5.562s5.312,0.75,8.312-1.188s2.5-4.188,1.75-7.25
                       S17.75,9.784,15.812,9.784z M21.125,15.597c-0.25,1.812-2.125,4.25-5.562,4.312s-7.5-1.875-8.312-3.688s1.688-5.938,5.125-4.562
                       c1.519,0.607,2.75-0.188,4.625,0S21.375,13.784,21.125,15.597z M13.875,12.847c-3.125-0.812-4.063,0.438-4.5,1.312
                       c-0.5,1,0.5,2.875,2.812,3.75s3.625-1.188,4.125-1.75S17,13.659,13.875,12.847z M14.75,16.034
                       c-0.688,0.688-1.375,1.125-2.688,0.375s-2.438-2.312-0.188-2.75c1.126-0.22,1.938,0.812,2.625,0.812S15.438,15.347,14.75,16.034z"
                       />
                    </svg>
                </div>
                <div class="sheet_tag" :class="{selected: type_tag=='豆'}" @click="type_tag='豆'">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><title/><g id="Icons"><path d="M11.945,11.083a1,1,0,1,0-1.927-.535,39.174,39.174,0,0,0-1.306,7.4,1,1,0,0,0,.919,1.075c.026,0,.053,0,.079,0a1,1,0,0,0,1-.922A37.169,37.169,0,0,1,11.945,11.083Z"/><path d="M40.435,15.565A10.24,10.24,0,0,0,28.192,13.9c-.428.242-.837.512-1.256.768a43.1,43.1,0,0,0-1.1-5.187,10.209,10.209,0,0,0-19.674,0,43.058,43.058,0,0,0,0,23.046,10.2,10.2,0,0,0,5.076,6.285,10.214,10.214,0,0,0,14.569,5.3,43.056,43.056,0,0,0,16.3-16.3A10.242,10.242,0,0,0,40.435,15.565Zm-26.1,24.7a8.151,8.151,0,0,1-1.052-1.768A71.324,71.324,0,0,1,26.466,28.155a69.107,69.107,0,0,0,13.2-10.415,8.151,8.151,0,0,1,1.052,1.768A71.324,71.324,0,0,1,27.534,29.845,69.107,69.107,0,0,0,14.336,40.26ZM16.993,4.068a8.133,8.133,0,0,1,1.993.505,71.428,71.428,0,0,1-2.014,16.664c-.181.811-.357,1.617-.529,2.44a42.915,42.915,0,0,0-2.667,3.517c.362-2.418.81-4.438,1.248-6.411A69.1,69.1,0,0,0,16.993,4.068ZM29.177,15.637a8.216,8.216,0,0,1,9.082.679A67.422,67.422,0,0,1,25.389,26.47a72.238,72.238,0,0,0-12.733,9.849,8.2,8.2,0,0,1,.981-5.143A41.065,41.065,0,0,1,29.177,15.637Zm-5.268-5.624a40.856,40.856,0,0,1,1.168,5.847,43.017,43.017,0,0,0-5.949,4.892,70.857,70.857,0,0,0,1.84-15.071A8.2,8.2,0,0,1,23.909,10.013ZM8.091,31.988a41.055,41.055,0,0,1,0-21.976,8.231,8.231,0,0,1,6.9-5.943,67.349,67.349,0,0,1-1.922,16.28,73.723,73.723,0,0,0-1.8,11.176,10.188,10.188,0,0,0-.656,4.448A8.194,8.194,0,0,1,8.091,31.988Zm32.272-5.164a41.065,41.065,0,0,1-15.54,15.539,8.222,8.222,0,0,1-9.072-.689A67.408,67.408,0,0,1,28.611,31.53a72.238,72.238,0,0,0,12.733-9.849A8.2,8.2,0,0,1,40.363,26.824Z"/><path d="M28.7,34.788a36.971,36.971,0,0,1-5.845,4.091,1,1,0,0,0,.985,1.742A39.1,39.1,0,0,0,30,36.309a1,1,0,0,0-1.3-1.521Z"/></g></svg>
                </div>
                <div class="sheet_tag" :class="{selected: type_tag=='蛋'}" @click="type_tag='蛋'">
                    <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                            width="52.307px" height="52.307px" viewBox="0 0 52.307 52.307" style="enable-background:new 0 0 52.307 52.307;"
                            xml:space="preserve">
                        <g>
                            <path d="M48.93,22.646c-0.938-0.875-1.5-2.375-1.375-3.938c0.125-1.563,0.312-3.875-1.125-4.938c-1.437-1.062-5.062-0.125-6.625,0
                                c-1.562,0.125-2.062-1.562-2.812-3.188s-1.5-2.875-4.812-2.625c-3.312,0.25-6.125,3.438-7.188,3.875
                                c-1.063,0.437-2.812-0.312-3.5-0.625c-0.688-0.313-1.438-2.75-4.812-2.75s-5.375,5-6.375,6.5s-2.077,2-2.751,1.438
                                c-1.875-1.562-4.687-0.625-5.437,0.625s-0.688,2.25,0.75,5.438c1.438,3.188-2.25,4.125-2.812,6.812
                                c-0.562,2.688,3.25,3.438,4.75,4.75c1.5,1.312,0.438,4.438,3,6.062s6,1.875,7.438,0.875s3.188,2.375,6.625,2.438
                                c3.437,0.063,7.312-3.5,8.875-4.062c1.562-0.562,5.438,4.812,7.438,5c2,0.188,3.312-0.125,4.125-2.062c0.813-1.937-0.312-4.125,1-5
                                c1.312-0.875,3.25-0.438,5.438-0.812c2.188-0.374,2.125-2.375,3.312-7C53.244,24.835,49.868,23.521,48.93,22.646z M50.493,28.271
                                c-0.438,1.438-1,6.375-3.062,6.688c-2.062,0.312-4.25,0.25-5.25,1s-1.688,1.5-1.5,2.938c0.188,1.438-0.438,4-2,3.625
                                c-1.562-0.375-4.875-4.625-6.75-4.688c-1.875-0.063-3.438,0.312-5.688,1.812s-4,2.438-5.75,1.562s-1.188-2.75-4.312-2.375
                                s-4.25,1.312-6.438,0.062s-2.5-2.125-2.5-3.562c0-1.438-0.312-2.5-1.875-3.312c-1.563-0.812-4-1.125-2.75-3.312
                                c1.25-2.188,3.688-3.125,2.562-5.875s-2.25-5.875,0-5.188c2.25,0.688,3.312,0.75,4.688,0.312c0.991-0.315,3.312-3.75,4.125-5.125
                                s1.5-2.5,3.125-2.312c1.625,0.188,2.875,3.062,5.375,3.125c2.5,0.063,3.875-0.75,5.938-2.375c2.063-1.625,2.625-1.5,4.062-1.438
                                c1.437,0.062,2.5,0.625,3.125,2.125s1.125,3.188,2.25,3.5c1.125,0.312,3.438-0.375,4.75-0.5c1.312-0.125,3.375-1.062,2.812,1.438
                                c-0.562,2.5-0.062,5.438,1.875,7.125C49.242,25.208,50.93,26.833,50.493,28.271z M20.805,17.708c-3.812,0.812-5.966,2.19-7.75,4.5
                                c-1.062,1.375-1.938,4.062-0.438,7.188s3.562,4.938,8,5.688s7.938-0.562,11.5-4.688c3.562-4.126-0.125-8.312-1.688-10.188
                                C28.866,18.333,24.618,16.896,20.805,17.708z M28.805,30.771c-2.938,1.938-5.5,2.562-9,2.25c-3.5-0.312-5.438-2.688-5.75-5.562
                                s0.875-5.688,5-7.125c1.979-0.689,4-0.75,5.875-0.75s5.875,2.625,6.25,4.562C31.555,26.083,31.743,28.833,28.805,30.771z
                                M18.618,22.521c-1.062,0.75-1.938,1.688-2.062,3.438s1.473,2.375,2.062,2.375c0.312,0,0.938-0.438,0.688-0.812
                                s-1.125-1.562-0.562-2.375c0.563-0.812,1.375-1.188,2.625-1.5c1.25-0.312,1-0.688,1-1.312S19.68,21.771,18.618,22.521z"/>
                    </svg>
                </div>
                <div class="sheet_tag" :class="{selected: type_tag=='菜'}" @click="type_tag='菜'">
                    <svg enable-background="new 0 0 239.121 211.139" height="211.139px" id="Layer_1" version="1.1" viewBox="0 0 239.121 211.139" width="239.121px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="M213.082,19.504c-1.18-1.459-3.297-3.063-6.014-3.057c-6.08,0.763-7.246,4.442-9.848,7.833   c-1.24,1.941-2.588,4.221-4.098,6.735C173.98,11.865,147.473,0,118.229,0C88.176,0,61.016,12.532,41.768,32.622   c-4.035-4.349-8.738-7.2-14.217-7.697c-4.926-0.075-9.379,3.215-11.916,7.891C5.686,50.217,0,70.383,0,91.836   c0.004,58.263,41.85,106.747,97.174,117.206c0.365,0.074,0.732,0.14,1.098,0.209c0.088,0.016,0.176,0.031,0.264,0.047   c6.385,1.201,12.967,1.843,19.693,1.841c0.182,0,0.361-0.009,0.543-0.01c0.264,0.001,0.525,0.01,0.791,0.01   c66.021,0,119.553-53.401,119.559-119.303C239.188,62.905,230.461,40.058,213.082,19.504z M187.346,39.396   c0.109,0.113,0.234,0.198,0.352,0.299c-6.834,10.342-16.527,22.417-31.717,31.955c-11.117,6.976-26.291,18.144-39.307,28.065   c0.043-0.765,0.072-1.534,0.072-2.314c-0.051-13.62-6.088-30.083-8.023-47.491c-0.137-1.221-0.201-2.407-0.201-3.562   c-0.367-19.22,19.256-30.847,29.695-34.263C157.316,16.128,174.299,25.844,187.346,39.396z M118.229,10.001   c3.609,0,7.17,0.206,10.674,0.593c-11.57,5.815-25.086,17.35-25.381,35.754c0,1.345,0.074,2.718,0.236,4.123   c2.072,18.093,8.043,34.767,7.99,46.93c-0.002,2.424-0.236,4.635-0.734,6.654c-7.744,5.968-14.248,11.108-17.943,14.046   c-2.004-2.554-4.072-5.049-6.199-7.453C66.027,87.256,62.328,82.472,55.996,60.36c-2.201-6.989-4.922-13.765-8.258-19.495   C65.26,21.886,90.328,10.004,118.229,10.001z M10,91.836c0.004-19.683,5.205-38.112,14.316-54.058   c1.734-2.799,2.514-2.781,3.234-2.856c1.227-0.256,5.414,2.11,9.18,7.482c3.82,5.222,7.422,12.724,9.635,20.655   c6.336,23.059,12.361,31.367,33.064,54.268c18.654,20.475,33.021,51.159,32.736,64.2c0,0.964-0.072,1.799-0.193,2.476   c-1.246,7.053-2.117,11.182-2.662,13.479c-0.535,2.289-0.664,2.352-0.609,2.378l-0.01,0.02l-0.002,0.009   c-0.09,0.225-0.139,0.454-0.193,0.682c-3.572-0.362-7.094-0.899-10.557-1.595c-3.102-0.667-10.016-2.623-10.453-2.643   C42.654,182.614,10.09,141.058,10,91.836z M134.727,199.726c-5.172,0.894-10.488,1.373-15.916,1.405   c-0.033,0-0.064-0.001-0.098-0.001c0.592-2.308,1.568-6.723,3.109-15.384c0.238-1.364,0.342-2.769,0.342-4.217   c-0.223-14.289-9.537-35.884-23.139-55.387c10.031-7.983,43.102-34.021,62.264-46.019c17.705-11.092,28.639-25.391,35.896-36.664   c3.625-5.631,6.361-10.542,8.443-13.77c0.467-0.733,0.904-1.371,1.291-1.902c15.008,18.602,22.135,37.914,22.199,64.05   c-0.086,48.09-31.172,88.866-74.41,103.51C152.924,195.95,138.664,199.046,134.727,199.726z" fill="#231F20"/><path d="M199.344,141.89c-0.469-0.293-1.084-0.153-1.379,0.314c-13.936,22.195-36.701,38.538-63.518,44.348   c-0.541,0.115-0.883,0.647-0.766,1.189c0.115,0.538,0.648,0.881,1.189,0.766c27.35-5.927,50.566-22.587,64.787-45.237   C199.953,142.799,199.811,142.183,199.344,141.89z" fill="#231F20"/><path d="M212.105,108.562c-0.541-0.106-1.064,0.25-1.168,0.792c-1.213,6.295-3.039,12.378-5.424,18.185   c-0.209,0.509,0.035,1.094,0.545,1.304c0.512,0.21,1.096-0.035,1.307-0.544c2.432-5.931,4.297-12.14,5.535-18.568   C213.004,109.189,212.65,108.666,212.105,108.562z" fill="#231F20"/></g></svg>
                </div>
                <div class="sheet_tag" :class="{selected: type_tag=='湯'}" @click="type_tag='湯'">
                    <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                    width="44.351px" height="44.351px" viewBox="0 0 44.351 44.351" style="enable-background:new 0 0 44.351 44.351;"
                    xml:space="preserve">
               <g>
                   <path d="M42.425,21.937c-1.417-0.166-3.917,0.167-4.082-0.166c-0.168-0.334,0.25-5.25-0.333-8.167s-4.083-2.333-6.083-2.333
                       s-7.333-0.167-7.333-0.167s-0.333-1.167-0.167-1.75c0.167-0.583,0.833-0.25,1.667-0.833c0.833-0.584,0.583-1.834-0.833-2.334
                       c-1.417-0.5-5.5-0.5-7.25,0.167s-2,2.25-0.583,2.833c1.417,0.584,1.333,2,1.25,2.5s-2.75,0.5-4.333,0.584
                       c-1.586,0.083-5.669,0.916-5.669,0.916c-2.167,0.584-2.75,2.167-2.5,3.584c0.25,1.416,0.167,5.666,0.167,5.666
                       s-1.667,0-3.833-0.166c-2.167-0.167-2.583,2.166-2.5,4.666s5.25,1.834,6.167,2c0.917,0.167,0.5,5.25,0.667,6.834
                       c0.167,1.583,1.583,2.75,5.833,2.75s22.5-0.25,24-0.584c1.5-0.333,1.583-3.583,1.75-4.916c0.167-1.334-0.25-5.167,0-5.167
                       s4.25,0,5.083-0.083c0.833-0.084,0.75-1.5,0.833-3.417C44.425,22.437,43.841,22.104,42.425,21.937z M6.675,27.937
                       c-0.167,0.334-2.917,0-4.583-0.25c-1.666-0.25-0.834-2.083-0.834-3.166c0-1.084,0.583-1.334,1.667-1.334
                       c1.083,0,3.5,0.167,3.5,0.167C6.925,23.271,6.841,27.604,6.675,27.937z M22.841,9.521c0-0.834,0.25-2.667,0.25-2.667
                       s0.417,1.583,0.417,2.5s0.083,1.833-0.333,1.917C22.758,11.354,22.841,10.354,22.841,9.521z M21.591,6.937v4.584h-0.333
                       l-0.167-4.667L21.591,6.937z M8.591,15.104c1.083-0.333,7.417-1.917,13.5-2c6.083-0.083,13.833-0.667,14.333,0.667
                       c0.49,1.307,0.182,2.924,0.169,2.988c0.007-0.079-0.182-0.552-6.003-0.322c-6.333,0.25-12.167,0.75-16.583,1.167
                       c-4.417,0.417-6.25,0.333-6.25,0.333S7.508,15.437,8.591,15.104z M36.841,19.354c-0.083,0.25-0.25,1.833-0.333,3.917
                       c-0.083,2.083,0.083,7.916,0,10.75c-0.083,2.833-1.167,2.333-1.667,2c-0.5-0.334-0.167-4.417-0.25-8.5
                       c-0.083-4.084,0.333-5.834-0.333-6.084c-0.667-0.25-1.167,0.5-1.333,1.834c-0.167,1.333-0.167,7.083-0.167,9
                       c0,1.916,0.083,3.416-0.417,4c-0.5,0.583-6.167,0.333-10.667,0.333c-4.5,0-11.5-0.667-12.5-0.917s-0.5-3.833-0.667-6.583
                       s-0.862-8.71-0.5-8.917c0.583-0.333,5.417-0.75,6.333-0.666c0.917,0.083,0.75,1.25,0.667,2.916c-0.083,1.667,0.083,4.167,0,7.084
                       c-0.083,2.916-0.083,4.166,0.75,4.166s0.75-3.416,0.5-6.333s0.25-7.333,0.333-7.917c0.083-0.583,11-1,12.167-1.166
                       c1.167-0.167,1,1.583,1.167,5.166c0.167,3.584,0.167,5.417,0.583,5.667c0.417,0.25,1-0.333,1.25-2.5s0-7.833,0.25-8.417
                       c0.25-0.583,3.25-0.583,4,0C36.758,18.771,36.925,19.104,36.841,19.354z M42.675,26.771c-0.582,0.416-2.667-0.084-3.667-0.084
                       s-0.833-1.5-0.833-2.333s0.271-1.216,0.583-1.333c0.667-0.25,2.917,0,3.833,0.166C43.508,23.354,43.258,26.354,42.675,26.771z
                        M12.925,25.271c0-1.834,0.5-4.917-0.5-4.917c-0.25,0-0.25,1.583-0.25,3.5s0.25,5.167,0.333,6.75s-0.167,3.333,0.417,3.333
                       c0.583,0,0.833-2.75,0.75-4.166C13.591,28.354,12.925,27.104,12.925,25.271z"/>
                    </svg>
                </div>
            </div>
            <draggable class="all_recipes" v-model="all_recipes_by_type" chosen-class="chosen" force-fallback="true" :group="{ name: 'people', pull: 'clone', put: false }" animation="100" @start="onStart" @end="onEnd">
                <!-- <transition-group> -->
                    <div class="item" v-for="element in all_recipes_by_type" :key="element.id">{{element.name}}</div>
                <!-- </transition-group> -->
            </draggable>
        </div>

        <div class="week">
            <draggable class="area area1" v-model="w1" chosen-class="chosen" force-fallback="true" group="people" animation="100" @start="onStart" @end="onEnd">
                <div class="item" @mousedown="trash_start" @touchstart="trash_start" @mouseup="trash_end" @touchend="trash_end" v-for="element in w1" :key="element.id">{{element.name}}</div>
            </draggable>

            <draggable class="area area2" v-model="w2" chosen-class="chosen" force-fallback="true" group="people" animation="100" @start="onStart" @end="onEnd">
                <div class="item" @mousedown="trash_start" @touchstart="trash_start" @mouseup="trash_end" @touchend="trash_end" v-for="element in w2" :key="element.id">{{element.name}}</div>
            </draggable>

            <draggable class="area area3" v-model="w3" chosen-class="chosen" force-fallback="true" group="people" animation="100" @start="onStart" @end="onEnd">
                <div class="item" @mousedown="trash_start" @touchstart="trash_start" @mouseup="trash_end" @touchend="trash_end" v-for="element in w3" :key="element.id">{{element.name}}</div>
            </draggable>

            <draggable class="area area4" v-model="w4" chosen-class="chosen" force-fallback="true" group="people" animation="100" @start="onStart" @end="onEnd">
                <div class="item" @mousedown="trash_start" @touchstart="trash_start" @mouseup="trash_end" @touchend="trash_end" v-for="element in w4" :key="element.id">{{element.name}}</div>
            </draggable>

            <draggable class="area area5" v-model="w5" chosen-class="chosen" force-fallback="true" group="people" animation="100" @start="onStart" @end="onEnd">
                <div class="item" @mousedown="trash_start" @touchstart="trash_start" @mouseup="trash_end" @touchend="trash_end" v-for="element in w5" :key="element.id">{{element.name}}</div>
            </draggable>
        </div>

        <draggable class="trash" :class="{active: show_trash}" v-model="trash" chosen-class="chosen" force-fallback="true" :group="{ name: 'people', pull: false , put: true }" animation="100" @start="onStart" @end="onEnd">
            <svg fill="currentColor" stroke="currentColor" enable-background="new 0 0 40 40" version="1.1" viewBox="0 0 40 40" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="M28,40H11.8c-3.3,0-5.9-2.7-5.9-5.9V16c0-0.6,0.4-1,1-1s1,0.4,1,1v18.1c0,2.2,1.8,3.9,3.9,3.9H28c2.2,0,3.9-1.8,3.9-3.9V16   c0-0.6,0.4-1,1-1s1,0.4,1,1v18.1C33.9,37.3,31.2,40,28,40z"/></g><g><path d="M33.3,4.9h-7.6C25.2,2.1,22.8,0,19.9,0s-5.3,2.1-5.8,4.9H6.5c-2.3,0-4.1,1.8-4.1,4.1S4.2,13,6.5,13h26.9   c2.3,0,4.1-1.8,4.1-4.1S35.6,4.9,33.3,4.9z M19.9,2c1.8,0,3.3,1.2,3.7,2.9h-7.5C16.6,3.2,18.1,2,19.9,2z M33.3,11H6.5   c-1.1,0-2.1-0.9-2.1-2.1c0-1.1,0.9-2.1,2.1-2.1h26.9c1.1,0,2.1,0.9,2.1,2.1C35.4,10.1,34.5,11,33.3,11z"/></g><g><path d="M12.9,35.1c-0.6,0-1-0.4-1-1V17.4c0-0.6,0.4-1,1-1s1,0.4,1,1v16.7C13.9,34.6,13.4,35.1,12.9,35.1z"/></g><g><path d="M26.9,35.1c-0.6,0-1-0.4-1-1V17.4c0-0.6,0.4-1,1-1s1,0.4,1,1v16.7C27.9,34.6,27.4,35.1,26.9,35.1z"/></g><g><path d="M19.9,35.1c-0.6,0-1-0.4-1-1V17.4c0-0.6,0.4-1,1-1s1,0.4,1,1v16.7C20.9,34.6,20.4,35.1,19.9,35.1z"/></g></svg>
        </draggable>

        <div class="Ingredient_info">
            <div v-if="all_Ingredient_not_completed_count">未取得食材：{{ all_Ingredient_not_completed_count }} 項</div>
            <div v-else>沒有要買的食材了!</div>
            <!-- <div class="toggle_switch">
                <span @click="toggle_switch=false; visibility='all'">全部</span>
                <div class="switch_wrap">
                    <div class="switch" :class="{active:toggle_switch}" @click="toggle_switch=!toggle_switch"></div>
                </div>
                <span @click="toggle_switch=true; visibility='notcompleted'">未取得</span>
            </div> -->
        </div>

        <draggable class="check_list" v-model="all_Ingredient" chosen-class="chosen" force-fallback="true" group="check_list" animation="100" @start="onStart" @end="onEnd">
            <div class="ingredient_item" v-for="element in all_Ingredient" :key="element" @click="complete_list(element)" :class="classObject(element)">
                <div class="check_icon" @click="onclick(element)">
                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" focusable="false" viewBox="0 0 12 12">
                        <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 7l3 3 7-7"/>
                    </svg>
                </div>
                <div class="flex jcsb">
                    <div class="ingredient_name">{{ element.name }}</div>
                    <div v-if="element.unit==='少許'" class="ingredient_quantity"><span class="note" v-if="element.note">{{ `(${element.note})` }}</span>{{ element.unit }} X {{ element.quantity }}</div>
                    <div v-else class="ingredient_quantity"><span class="note" v-if="element.note">{{ `(${element.note})` }}</span>{{ element.quantity }} {{ element.unit }}</div>
                </div>
            </div>
        </draggable>


    </div>
    <script>
        // 全局註冊组件
        Vue.component('vuedraggable', window.vuedraggable)
        var app = new Vue({
            el: '#app',
            components: {
                vuedraggable: window.vuedraggable,
            },
            data() {
                return {
                    show_trash: false,
                    init: true,
                    drag: false,
                    loading: true,
                    toggle_switch: false,
                    all_recipes: [
                        // {
                        //     id: 1,
                        //     name: 'AA',
                        //     Ingredient: [
                        //         { name: 'a', quantity: 1, unit: '少許' },
                        //         { name: 'b', quantity: 1, unit: '台斤' },
                        //     ]
                        // },
                        // {
                        //     id: 2,
                        //     name: 'BB',
                        //     Ingredient: [
                        //         { name: 'a', quantity: 1, unit: '台斤' },
                        //         { name: 'c', quantity: 1, unit: '台斤' },
                        //     ]
                        // },
                        // {
                        //     id: 3,
                        //     name: 'CC',
                        //     Ingredient: [
                        //         { name: 'a', quantity: 5, unit: '台斤' },
                        //         { name: 'c', quantity: 5, unit: '台斤' },
                        //     ]
                        // },
                    ],
                    all_recipes_by_type: [],
                    w1: [
                            // {
                            //     "id": 3,
                            //     "name": "番茄炒蛋",
                            //     "type": "蛋",
                            //     "Ingredient": [
                            //         {
                            //             "name": "蛋",
                            //             "quantity": 4,
                            //             "unit": "顆"
                            //         },
                            //         {
                            //             "name": "牛番茄",
                            //             "quantity": 3,
                            //             "unit": "顆"
                            //         },
                            //         {
                            //             "name": "青蔥",
                            //             "quantity": 1,
                            //             "unit": "支"
                            //         }
                            //     ]
                            // }
                        ],
                    w2: [],
                    w3: [],
                    w4: [],
                    w5: [],
                    trash: [],
                    all_Ingredient: [
                        // {
                        //     "name": "蛋",
                        //     "quantity": 4,
                        //     "unit": "顆",
                        //     "done": false,
                        //     "note": ""
                        // },
                        // {
                        //     "name": "牛番茄",
                        //     "quantity": 3,
                        //     "unit": "顆",
                        //     "done": true,
                        //     "note": ""
                        // },
                        // {
                        //     "name": "青蔥",
                        //     "quantity": 1,
                        //     "unit": "支",
                        //     "done": false,
                        //     "note": ""
                        // }
                    ],
                    all_Ingredient_switch: {
                        all: (todos) => todos,
                        notcompleted: (todos) => todos.filter((i) => !i.done)
                    },
                    visibility: 'all',
                    type_tag: '肉',
                    debounceTimer: '',
                };
            },
            methods: {
                trash_start(){
                    this.show_trash = true;

                },
                trash_end(){
                    this.show_trash = false;

                },
                onStart() {
                    this.drag = true;
                },
                onEnd() {
                    this.drag = false;
                    this.show_trash = false;
                    this.onDataChange()
                },
                complete_list(element){
                    console.log(element)
                    if(element.done){
                        element.done = false
                    }else{
                        element.done = true
                        element.quantity_bought = element.quantity
                        element.note = null
                    }
                    this.onDataChange()
                    console.log('all_Ingredient:', this.all_Ingredient)
                },
                onclick(el) {
                    console.log('all_Ingredient:', this.all_Ingredient)
                },
                async fetchData() {
                    try {
                        // 發送兩個 API 請求並同時等待
                        const [response1, response2] = await Promise.all([
                        fetch('https://sheets.googleapis.com/v4/spreadsheets/1Ae9iudpo5tfRlF9uRGpoTdba8-oAvWRcRnBMwoDIE1E/values/%E8%8F%9C%E8%89%B2?alt=json&key=AIzaSyDOIUeiM4u_T96sb_A0HyKAcugEsviANbo'), // 菜色
                        fetch('https://sheets.googleapis.com/v4/spreadsheets/1Ae9iudpo5tfRlF9uRGpoTdba8-oAvWRcRnBMwoDIE1E/values/%E9%A3%9F%E8%AD%9C?alt=json&key=AIzaSyDOIUeiM4u_T96sb_A0HyKAcugEsviANbo')  // 食譜
                        ]);

                        // 檢查兩個 API 是否都返回成功
                        if (!response1.ok || !response2.ok) {
                        throw new Error('Network response was not ok');
                        }

                        // 解析兩個 API 的 JSON 數據
                        var recipe = await response1.json();
                        var Ingredient = await response2.json();

                        recipe = this.convertArrayToObject(recipe.values)
                        Ingredient = this.convertArrayToObject(Ingredient.values)

                        this.all_recipes = this.formatData(recipe, Ingredient)
                        this.filter_recipes(this.type_tag)
                    } catch (error) {
                        console.error('Error fetching data:', error);
                    } finally {
                    }
                },
                convertArrayToObject(array){
                    const keys = array[0]; // 取得第一個子陣列作為鍵
                    const result = [];

                    for (let i = 1; i < array.length; i++) {
                        const obj = {};
                        keys.forEach((key, index) => {
                        // 為每個鍵值對建立屬性
                        obj[key] = array[i][index];
                        });
                        result.push(obj);
                    }
                    // console.log('result:',result)
                    // 將 recipe_id 改為 id，並將其轉換為數字
                    result.forEach(i=> i.id = Number(i.id))
                    return result
                },
                formatData(recipe, Ingredient){
                    return recipe.map(i=>{
                        var arr = []
                        Ingredient.forEach(j=>{
                            if(i.id==j.id){
                                var obj ={
                                    name: j.ingredient_name,
                                    quantity: Number(j.quantity),
                                    unit: j.unit,
                                    type: j.type,
                                    repeat: false
                                }
                                arr.push(obj)
                            }
                        })
                        return{
                            ...i,
                            Ingredient: arr,
                        }
                    })
                },
                async save(){
                    console.log('save')
                    let requestData = {
                        all_Ingredient: JSON.stringify(this.all_Ingredient),
                        w1: JSON.stringify(this.w1),
                        w2: JSON.stringify(this.w2),
                        w3: JSON.stringify(this.w3),
                        w4: JSON.stringify(this.w4),
                        w5: JSON.stringify(this.w5),
                    }
                    try {
                        const response = await fetch('https://script.google.com/macros/s/AKfycbyo4AfzpCGqla2Ptc426cmSmAP3zv0RoqHklMiHM5AMks9E7AxEk6xzOjzgEhbV8sx1QQ/exec', {
                        method: 'POST',
                        headers: {
                            // 'Content-Type': 'application/json'
                            'Content-Type': 'text/plain;charset=utf-8',
                        },
                        body: JSON.stringify(requestData)
                        });
                        if (!response.ok) {
                        throw new Error(`HTTP錯誤！狀態碼：${response.status}`);
                        }
                        const res = await response.json();
                        console.log(res.message);
                    } catch (error) {
                        console.error('POST出錯:', error);
                    }
                },
                onDataChange() {
                    clearTimeout(this.debounceTimer);
                    this.debounceTimer = setTimeout(this.save, 3000);
                },
                async load(){
                    console.log('load active')
                    try {
                        const response = await fetch('https://script.google.com/macros/s/AKfycbyo4AfzpCGqla2Ptc426cmSmAP3zv0RoqHklMiHM5AMks9E7AxEk6xzOjzgEhbV8sx1QQ/exec');
                        const data = await response.json();
                        // console.log(data)
                        var {all_Ingredient, w1,w2,w3,w4,w5} = data
                        this.all_Ingredient= JSON.parse(all_Ingredient)
                        this.w1= JSON.parse(w1)
                        this.w2= JSON.parse(w2)
                        this.w3= JSON.parse(w3)
                        this.w4= JSON.parse(w4)
                        this.w5= JSON.parse(w5)
                    } catch (error) {
                        console.error('Error:', error);
                    } finally {
                        this.loading = false;
                    }
                },
                filter_recipes(newValue){
                    this.all_recipes_by_type = this.all_recipes.filter(i=>i.type===newValue)
                },
                findDifferences(array1, array2) {
                    var arrayA = JSON.parse(JSON.stringify(array1))
                    var arrayB = JSON.parse(JSON.stringify(array2))
                    var differences = [];
                    arrayA.forEach(i=>{
                        arrayB.forEach(j=>{
                            if(j.repeat) return
                            // console.log(JSON.stringify(i))
                            // console.log(JSON.stringify(j))
                            if(JSON.stringify(i) === JSON.stringify(j)){
                                
                                i.repeat = true
                                j.repeat = true
                            }
                        })
                    })
                    arrayA = arrayA.filter(i=>i.repeat==false) 
                    arrayB = arrayB.filter(i=>i.repeat==false) 
                    return [...arrayA, ...arrayB];
                },
                sort_list(){
                    console.log('排序')
                    this.all_Ingredient.sort((a, b) => {
                        const typeOrder = ["根莖類", "葉菜類", "辛香料", "乾貨類", "豆類", "肉類", "蛋類"];
                        // 比較 type 的順序
                        const typeComparison = typeOrder.indexOf(a.type) - typeOrder.indexOf(b.type);
                        if (typeComparison !== 0) {
                            return typeComparison;
                        }
                        // 如果 type 一樣，則比較 done (false 在前，true 在後)
                        return a.done - b.done;
                    });
                },
                classObject(item) {
                    return {
                        'root-class': item.type === '根莖類',
                        'leaf-class': item.type === '葉菜類',
                        'spices-class': item.type === '辛香料',
                        'goods-class': item.type === '乾貨類',
                        'bean-class': item.type === '豆類',
                        'meat-class': item.type === '肉類',
                        'done': item.done
                    };
                }
            },
            computed:{
                all_Ingredient_not_completed_count(){
                    return this.all_Ingredient.filter(i => !i.done).length
                },
                count(){
                    console.log('count acitve')
                    let Ingredients = this.w1.concat(this.w2, this.w3, this.w4, this.w5);
                    Ingredients = Ingredients.reduce((acc, current)=>{
                        acc.push(...current.Ingredient)
                        return acc;
                    }, [])
                    return Ingredients
                },
                all_Ingredient_filtered() {
                    return this.all_Ingredient_switch[this.visibility](this.all_Ingredient)
                },
            },
            created() {
                this.fetchData();
                this.load()
                // setInterval(this.load, 10000);  //10秒更新一次
            },
            mounted() {
            },
            watch: {
                count(newValue, oldValue) {
                    if(this.init){
                        this.init = false
                        return
                    }
                    console.log(`changed from ${oldValue.length} to ${newValue.length}`);
                    const differences = this.findDifferences(oldValue, newValue);
                    if(newValue.length > oldValue.length){
                        console.log(`增加${newValue.length - oldValue.length}個`, differences); 

                        this.all_Ingredient.forEach(i => {
                            differences.forEach(n => {
                                if(n.repeat) return
                                if(i.name==n.name && i.unit==n.unit ){
                                    n.repeat = true
                                    i.quantity += n.quantity
                                    if(i.quantity_bought && i.quantity > i.quantity_bought){
                                        i.note = '不足'+ n.quantity
                                        i.done = false
                                    }else if(i.quantity == i.quantity_bought){
                                        i.done = true
                                        i.note = ''
                                    }
                                }
                            });
                        });
                        differences.forEach(n=>{
                            if(n.repeat==false){
                                this.all_Ingredient.push({
                                    ...n,
                                    quantity_bought: null,
                                    done: false,
                                    note: null
                                })
                            }
                        })
                    }else if(newValue.length < oldValue.length){
                        console.log(`減少${oldValue.length - newValue.length}個`, differences); 
                        this.all_Ingredient.forEach(i => {
                            differences.forEach(n => {
                                if(i.name==n.name && i.unit==n.unit ){
                                    i.quantity -= n.quantity
                                    if(i.quantity < i.quantity_bought){
                                        i.note = '多出'+ Math.abs(n.quantity)
                                        i.done = true
                                    }else if(i.quantity == i.quantity_bought){
                                        i.done = true
                                        i.note = ''
                                    }
                                }
                            });
                        });
                        this.all_Ingredient = this.all_Ingredient.filter(i=>i.quantity>0)
                    }
                    this.sort_list()
                },
                type_tag(newValue, oldValue){
                    this.filter_recipes(newValue)
                }
            }
        });
    </script>
</body>
</html>